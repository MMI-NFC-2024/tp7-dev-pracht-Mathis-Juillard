---
import Layout from "../layouts/Layout.astro";
import PlotFigure from "../components/PlotFigure.astro";
import * as Plot from "@observablehq/plot";
import population from "../assets/population.json";

// Années disponibles
const annees = [...new Set(population.map(d => d["Période"]))].sort((a,b)=>b-a);
const annee = annees[0];   // plus récente

// Lignes pour cette année, pas les "Total" d'âge
const rows = population
  .filter(d =>
    d["Période"] === annee &&
    d["Sexe"] !== undefined &&
    d["Âge"]  !== "Total" &&
    d["Valeur"] != null
  )
  .map(d => ({ ...d, Valeur: Number(d["Valeur"]) }));

const options = {
  width: 900,
  height: 420,
  x: { label: "Âge" },
  y: { label: "Population", grid: true },
  color: { label: "Sexe", legend: true, scheme: "Tableau10" },
  marks: [
    Plot.barY(rows, { x: "Âge", y: "Valeur", fill: "Sexe", tip: true })
  ]
};
---

<Layout title={`TP7 — Population (serveur) ${annee}`}>
  <h1 class="text-2xl mb-2">Population — année {annee}</h1>
  <PlotFigure {options} />
</Layout>
