---
import Layout from "../layouts/Layout.astro";
import "leaflet/dist/leaflet.css";
---

<Layout title="TP7 — Carte Leaflet">
  <h1 class="text-2xl mb-4">Leaflet — Départements / Population 2021</h1>

  <!-- Un seul conteneur, avec une vraie hauteur -->
  <div id="map" style="height:600px;border-radius:12px;overflow:hidden"></div>

  <script type="module">
    // On charge Leaflet et ses icônes côté client
    const start = async () => {
      const { default: L } = await import("leaflet");
      const iconUrl       = (await import("leaflet/dist/images/marker-icon.png")).default;
      const iconRetinaUrl = (await import("leaflet/dist/images/marker-icon-2x.png")).default;
      const shadowUrl     = (await import("leaflet/dist/images/marker-shadow.png")).default;
      L.Icon.Default.mergeOptions({ iconUrl, iconRetinaUrl, shadowUrl });

      const map = L.map("map", { zoomControl: true }).setView([46.6033, 1.883], 6);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);

      L.marker([46.6033, 1.883]).addTo(map).bindPopup("Centre de la France");
      L.control.scale().addTo(map);

      // au cas où
      requestAnimationFrame(() => map.invalidateSize());
    };

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", start, { once: true });
    } else {
      start();
    }
  </script>
</Layout>
