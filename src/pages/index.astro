---
import Layout from "../layouts/Layout.astro";
import PlotFigure from "../components/PlotFigure.astro";
import * as Plot from "@observablehq/plot";
import penguins from "../assets/penguins.json";

const options = {
  marginTop: 30,
  height: 380,
  color: {
    legend: true,
    label: "Espèce",
    domain: ["Adelie", "Chinstrap", "Gentoo"],
    range: ["#3b82f6", "#eab308", "#ef4444"] 
  },
  x: { label: "Longueur du bec (mm) →", grid: true },
  y: { label: "↑ Profondeur du bec (mm)", grid: true },
  marks: [
    Plot.dot(
      penguins.filter(d => d.culmen_length_mm != null && d.culmen_depth_mm != null),
      { x: "culmen_length_mm", y: "culmen_depth_mm", stroke: "species", r: 3.5, tip: true }
    )
  ]
};

const cards = [
  { href: "/leaflet",              title: "Leaflet",
    desc:  "Carte des départements colorée par population (2021)." },
  { href: "/population-serveur",   title: "Population (serveur)",
    desc:  "Graphique rendu côté serveur avec Plot + JSDOM." },
  { href: "/population-geo",    title: "Population (carte)",
    desc:  "Graphique interactif filtrable (année, sexe, âge)." },
];
---

<Layout title="Accueil">
  <section class="mb-10">
    <h1 class="text-3xl font-semibold tracking-tight mb-2">TP7 — Observable Plot + Leaflet</h1>
    <p class="text-slate-400 max-w-2xl">
      Démo de graphiques et de cartographie avec <strong>Observable Plot</strong> et <strong>Leaflet</strong>,
      rendus avec Astro (serveur & client).
    </p>
  </section>

  <section class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-12">
    {cards.map(c => (
      <a href={c.href} class="group rounded-xl border border-white/10 p-5 bg-white/5 hover:bg-white/8 transition">
        <h3 class="font-semibold mb-1">{c.title}</h3>
        <p class="text-sm text-slate-400">{c.desc}</p>
        <span class="inline-flex items-center gap-1 mt-3 text-sm text-rose-300 group-hover:translate-x-0.5 transition">
          Ouvrir
          <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path d="M7.5 4H16v8.5h-2V7.91l-7.3 7.3-1.4-1.42 7.3-7.3H7.5V4z"/>
          </svg>
        </span>
      </a>
    ))}
  </section>

  <section>
    <h2 class="text-xl font-semibold mb-3">Exemple — Penguins (Scatterplot)</h2>
    <div class="rounded-xl border border-white/10 bg-white/5 p-3">
      <PlotFigure options={options} />
    </div>
  </section>
</Layout>
